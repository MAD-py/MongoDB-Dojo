# **MongoDB** Shell

**MongoDB** shell allows you to connect to MongoDB or MongoDB Atlas to work with the data directly from a terminal and to ease the database configuration process.

## CRUD

We will start by creating the crud for the Course entity. If you do not know the structure of this entity, you must first read the definition of the practical example that will be solved in this dojo.

## Create Courses

to create a single course we can use statement:

```bash
db.course.insertOne(
    {
        name: "Cloud Computing I",
        instructor: {
            "name": "Jose Gomez Gomez",
            "email": "josegg@gmail.com"
        },
        price: "$45.78",
        certifies: false
    }
)
```

With this statement we have created a document in the collection "course", to this document is autogenerated the field "_id" which is the one that will identify it within the collection.

to create multiple courses in a single statement we can use:

```bash
db.course.insertMany([
    {
        name: "Cloud Computing II",
        instructor: {
            "name": "Jose Gomez Gomez",
            "email": "josegg@gmail.com"
        },
        price: "$50.78",
        certifies: true
    },
    {
        name: "Cloud Computing III",
        instructor: {
            "name": "Jose Gomez Gomez",
            "email": "josegg@gmail.com"
        },
        co_instructor: {
            "name": "Juan Zapata Gomez",
            "email": "jzg@gmail.com"
        },
        price: "$38.00",
        certifies: true
    },
    {
        name: "Introduction to deep learning",
        instructor: {
            "name": "John Agudelo Gomez",
            "email": "jagudelo@gmail.com"
        },
        price: "$90.84",
        certifies: false
    }
])
```

With these two statements we have created 4 courses in our database.

## Read Courses

to get all the courses we can use statement:

```bash
db.course.find()
```

This statement returns all the documents created within the collection "course" since we do not use any type of filter, if you want to filter the courses you can do it with the following statement.

```bash
db.course.find({certifies: true})
```

With this new sentence we will only obtain the courses that have certificate, in MongoDB there are multiple operators to make filters as complex as you want, if you are interested in learning more about the operators that MongoDB offers you can consult them in the following [link](https://www.mongodb.com/docs/manual/reference/operator/query/).

## Update Courses

To update a single document we can use the following statement:

```bash
db.course.updateOne(
    {name: "Cloud Computing II"},
    {$set: {price: "$60.90"}}
)
```

With this sentence we have updated the value of the course that has the name "Cloud Computing II" to "$60.90" dollars, this sentence will only update the first document that it finds with this name regardless of whether the filter used returns more documents, if you want to update all documents that meet the filter we must do it with the following sentence.

```bash
db.course.updateMany(
    {instructor: {name: "Jose Gomez Gomez"}},
    {$set: {certifies: true}}
)
```

With this operation we have updated all the courses of the instructor "Jose Gomez Gomez", it is necessary to clarify that if any course of the instructor already had the certified value in true, this operation will overwrite it with the same value.

***Note:** The `$set` operator in the examples indicates the values to be updated in the documents.*

## Delete Courses:

To delete a single document we can use the following statement:

```bash
db.course.deleteOne({name: "Introduction to deep learning"})
```

With this we have removed the course "Introduction to deep learning" from our course collection, as in the updates this statement will only remove the first document and if we want to remove all the documents that meet our filter we can use the following statement.

```bash
db.course.deleteMany({certifies: true})

```

After this operation our "course" collection should be empty.

***Note:** To continue with the Dojo it is necessary to recreate all the courses, it is recommended to execute again the two learned sentences to create new documents in a collection.*

Now that we know how to use the basic operations it is time to test how the relations work inside *MongoDB*, for this we will create a new user and we will obtain the created document.

## Create Users

To create a user we will use the same creation statement that we used for the courses, the interesting thing now in this statement is in the courses section and the come section we define the courses completed by the user and the ones he has started, we can see in these two fields arrays of objects are stored using the name '$oid' this name is used to indicate to MongoDB that the value we are going to store is an ObjectID, which will be related to another different document. In order to execute this statement it is necessary to replace the 'course_id' with a valid id from the 'course' collection.

```bash
db.user.insertOne(
    {
        name: "Emanuel",
        last_name: "Rojas Moreno",
        emails: [
            {
                "email": "emanuel.rojas@gmail.com",
                "type": "academic"
            },
            {
                "email": "ema123@gmail.com",
                "type": "personal"
            }
        ],
        courses: {
            "completed": [
                {"$oid": course_id},
                {"$oid": course_id}
            ],
            "started": [{"$oid": course_id}]
        }
    }
)
```

With this we have created a relationship between this document of type user and several documents of type course, it must be taken into account that these relationships do not work as in the sql database, since if the id that we put as relationship does not exist in any collection of MongoDB, this will not generate any type of error.

## Read Users

Now, if we get all the users we will see that it will only show us the ids of the courses and not the complete object.

```bash
db.user.find()
```

If we want the relations to be resolved it is necessary to tell MongoDB to do it, this can be done with the following statement.

```bash
db.user.aggregate([
    {
        $lookup: {
            from: "course",
            localField: "courses.completed",
            foreignField: "_id",
            as: "courses.completed"
        }
    },
    {
        $lookup: {
            from: "course",
            localField: "courses.started",
            foreignField: "_id",
            as: "courses.started"
        }
    }
])
```

In this sentence we can notice that we no longer use the find method to obtain the documents of a collection, instead we use the aggregate method, this method allows us to create a pipeline of operations on a collection. In this case we are instructing it to perform two lookup type operations to resolve the relationships of the completed and started courses.

The result of this statement is the same as when executing the find method but this time we will get a list of objects that are the user's courses, instead of just a list of ids.

These are the most basic operations that can be performed on a collection, but within MongoDB there are many other operations, in case you want to continue learning about MongoDB I invite you to visit the official MongoDB [website](https://www.mongodb.com/docs/mongodb-shell/).